<!DOCTYPE html>

{% load static %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="//api.bitrix24.com/api/v1/"></script>
    <link href="{% static 'scripts/libs/chosen_v1.8.7/chosen.min.css' %}" rel="stylesheet">
    <link href="{% static 'style/msp.css' %}" rel="stylesheet">
    <script>
        let smartProcessId = {{ id }};
        let portalUrl = "{{ portal_url }}";
    </script>

    <title>МСП</title>
</head>
<body>
    <div class="product-container text-center m-3">
        <div class="row d-flex justify-content-between align-items-start">
            <div class="col d-flex align-items-start flex-column mb-3" style="max-width: 350px;">
                <div class="input-group input-group-sm mb-3 product-date-create-container">
                    <span class="input-group-text" id="dateCreate">Дата создания</span>
                    <input type="date" id="createdTime" class="form-control product-date-create-input" aria-label="Sizing example input" aria-describedby="dateCreate" disabled>
                </div>
                <div class="input-group input-group-sm product-date-cheanged-container">
                    <span class="input-group-text" id="dateChanged">Дата изменения</span>
                    <input type="date" id="updatedTime" class="form-control product-date-cheanged-input" aria-label="Sizing example input" aria-describedby="dateChanged" disabled>
                </div>
            </div>

            <div class="col d-flex align-items-start flex-column mb-3 responsible-container" style="max-width: 650px;">
                <div class="d-flex flex-row mb-3 input-group-sm responsible-created">
                    <label for="createdBy" class="input-group-text me-2 responsible-created-label">Кто заполнил</label>
                    <div class="col">
                        <a href="#" id="createdBy" class="responsible-created-url link-primary"></a>
                    </div>
                </div>
                <div class="d-flex flex-row mb-3 input-group-sm responsible-changed">
                    <label for="updatedBy" class="input-group-text me-2 responsible-changed-label">Кто изменил</label>
                    <div class="col">
                        <a href="#" id="updatedBy" class="responsible-changed-url link-primary"></a>
                    </div>
                </div>
            </div>

            <div class="col btn-group-vertical" role="group" aria-label="Vertical button group" style="max-width: 350px;">
                <button type="button" class="btn btn-outline-secondary">Инструкция по изменениям</button>
                <button type="button" class="btn btn-outline-secondary">История изменения</button>
            </div>

            <div class="col btn-group-vertical" role="group" aria-label="Vertical button group" style="max-width: 350px;">
                <button type="button" class="btn btn-outline-secondary">Открыть директорию</button>
                <button type="button" class="btn btn-outline-secondary">Загрузить файлы</button>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col">
                <button type="button" class="btn btn-success w-75 product-btn-save">Сохранить</button>
            </div>
            <div class="col">
                <button type="button" class="btn btn-primary w-75 product-btn-copy">Копировать</button>
            </div>
            <div class="col">
                <button type="button" class="btn btn-danger w-75 product-btn-remove">Удалить</button>
            </div>
            <div class="btn-group w-75" role="group" aria-label="Basic checkbox toggle button group" style="max-width: 200px;">
                <input type="checkbox" class="btn-check product-input-is-measured" id="btncheck1" autocomplete="off">
                <label class="btn btn-outline-secondary" for="btncheck1">Замер</label>
            </div>
            <div class="btn-group w-75" role="group" aria-label="Basic checkbox toggle button group" style="max-width: 200px;">
                <input type="checkbox" class="btn-check product-input-is-active" id="btncheck2" autocomplete="off">
                <label class="btn btn-outline-secondary" for="btncheck2">Активен</label>
            </div>
        </div>
        <div class="row mb-3">
            <div class="product-left col-6">
                <div class="card border-secondary-subtle mb-3 mh-100 w-100 file-upload-container">
                    <input type="file" id="mainPhoto" accept="image/1*" class="file-upload-input" style="display: none;">
                    <label for="mainPhoto" class="file-upload-label">
                        <div class="card-header fs-5 fw-bold header-size"  style="width: 100%;">Общее фото изделия</div>
                        <div class="upload-icon">&#x1F4E5;</div>
                        <div class="upload-text">Выберите файл</div>
                        <img id="imgMainPhoto" src="#" alt="Preview" class="preview-image" style="display: none;">
                    </label>
                </div>
                <div class="product-delivery">
                    <table class="table table-bordered table-sm mb-3">
                        <tr>
                            <td class="fw-bold bg-light table-header-size">Город доставки:</td>
                            <td class="p-0 m-0">
                                <input type="text" id="deliveryCity" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                            </td>
                            <td class="fw-bold bg-light table-header-size">Количество:</td>
                            <td class="p-0 m-0">
                                <input type="text" id="quantity" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="product-calculations">
                    <table class="table table-bordered table-sm mb-3">
                        <thead class="table-light">
                            <tr>
                                <th class="table-header-size">Себестоимость</th>
                                <th class="table-header-size">Комментарии ПРОИЗВОДСТВА</th>
                            </tr>
                        </thead>
                        <tr>
                            <td class="p-0 m-0">
                                <input type="text" id="costPrice_1" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                            </td>
                            <td class="p-0 m-0">
                                <input type="text" id="productionNotes_1" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                            </td>
                        </tr>
                        <tr>
                            <td class="p-0 m-0">
                                <input type="text" id="costPrice_2" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                            </td>
                            <td class="p-0 m-0">
                                <input type="text" id="productionNotes_2" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                            </td>
                        </tr>
                        <tr>
                            <td class="p-0 m-0">
                                <input type="text" id="costPrice_3" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                            </td>
                            <td class="p-0 m-0">
                                <input type="text" id="productionNotes_3" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="product-comment-rop col border border-secondary-subtle mb-2 bg-light bg-opacity-5 text-dark">
                    <label for="managerNotes" class="fs-6 fw-bold table-header-size">Заметки руководителя</label>
                    <textarea class="form-control rounded-0 px-0" id="managerNotes" rows="3"></textarea>
                </div>
            </div>
            <div class="product-right col-6">
                <div class="product-common-data">
                    <div class="border border-secondary-subtle mb-2 bg-light bg-opacity-5 text-dark">
                        <label for="" class="fs-5 fw-bold header-size">Общие данные</label>
                        <table class="table table-bordered table-sm mb-0">
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Общий габарит в мм.:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <input type="text" id="commonDimensions" class="mh-100 w-100 py-1 px-2 border-0" placeholder="Ш. В.">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Строгое соблюдение размера:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <select id="strictSizeCompliance" class="form-select form-select-sm border-0" aria-label="Small select example"></select>
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Система крепежа:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <select id="fasteningSystem" class="form-select form-select-sm border-0" aria-label="Small select example"></select>
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Толщина ППУ панелей:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <input type="text" id="hicknessPUT" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Коллекция и цвет обивочной ткани:</td>
                                <td colspan="1" class="p-0 m-0 table-body-size">
                                    <select id="upholsteryFabricCollection" class="form-select form-select-sm border-0" aria-label="Small select example"></select>
                                </td>
                                <td colspan="3" class="p-0 m-0 table-body-size">
                                    <input type="text" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Тип и цвет обивочной ткани:</td>
                                <td colspan="2" class="p-0 m-0 table-body-size">
                                    <input type="text" id="upholsteryFabricType" class="mh-100 w-100 py-1 px-2 border-0" disabled>
                                </td>
                                <td style="max-width: 90px;" class="table-header-size">Цвет:</td>
                                <td class="p-0 m-0 table-body-size">
                                    <input type="text" id="upholsteryFabricColor" class="mh-100 w-100 py-1 px-2 border-0" disabled>
                                </td>
                            </tr>
                            <tr>
                                <td class="table-header-size">Описание декора и комментарии:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <textarea class="form-control border-0 table-body-size" id="decorationDescription" rows="3"></textarea>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="product-distinctive-panels-1">
                    <div class="border border-secondary-subtle mb-2 bg-light bg-opacity-5 text-dark">
                        <label for="" class="fs-5 fw-bold header-size">Отличительные панели</label>
                        <table class="table table-bordered table-sm mb-0">
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Как отмечено на эскизе:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <input type="text" id="markedOnSketch_1" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Толщина ППУ панелей:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <input type="text" id="hicknessPUT_1" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Коллекция и цвет обивочной ткани:</td>
                                <td colspan="1" class="p-0 m-0 table-body-size">
                                    <select id="upholsteryFabricCollection_1" class="form-select form-select-sm border-0" aria-label="Small select example"></select>
                                </td>
                                <td colspan="3" class="p-0 m-0 table-body-size">
                                    <input type="text" id="" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Тип и цвет обивочной ткани:</td>
                                <td colspan="2" class="p-0 m-0 table-body-size">
                                    <input type="text" id="upholsteryFabricType_1" class="mh-100 w-100 py-1 px-2 border-0" disabled>
                                </td>
                                <td style="max-width: 90px;" class="table-header-size">Цвет:</td>
                                <td class="p-0 m-0 table-body-size">
                                    <input type="text" id="upholsteryFabricColor_1" class="mh-100 w-100 py-1 px-2 border-0" disabled>
                                </td>
                            </tr>
                            <tr>
                                <td class="table-header-size">Описание декора и комментарии:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <textarea class="form-control border-0 table-body-size" id="decorationDescription_1" rows="3"></textarea>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="product-distinctive-panels-2">
                    <div class="border border-secondary-subtle mb-2 bg-light bg-opacity-5 text-dark">
                        <label for="" class="fs-5 fw-bold header-size">Отличительные панели</label>
                        <table class="table table-bordered table-sm mb-0">
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Как отмечено на эскизе:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <input type="text" id="markedOnSketch_2" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Толщина ППУ панелей:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <input type="text" id="hicknessPUT_2" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Коллекция и цвет обивочной ткани:</td>
                                <td colspan="1" class="p-0 m-0 table-body-size">
                                    <select id="upholsteryFabricCollection_2" class="form-select form-select-sm border-0" aria-label="Small select example"></select>
                                </td>
                                <td colspan="3" class="p-0 m-0 table-body-size">
                                    <input type="text" class="mh-100 w-100 py-1 px-2 border-0" placeholder="">
                                </td>
                            </tr>
                            <tr>
                                <td style="max-width: 265px;" class="table-header-size">Тип и цвет обивочной ткани:</td>
                                <td colspan="2" class="p-0 m-0 table-body-size">
                                    <input id="upholsteryFabricType_2" type="text" class="mh-100 w-100 py-1 px-2 border-0" disabled>
                                </td>
                                <td style="max-width: 90px;" class="table-header-size">Цвет:</td>
                                <td class="p-0 m-0 table-body-size">
                                    <input id="upholsteryFabricColor_2" type="text" class="mh-100 w-100 py-1 px-2 border-0" disabled>
                                </td>
                            </tr>
                            <tr>
                                <td class="table-header-size">Описание декора и комментарии:</td>
                                <td colspan="4" class="p-0 m-0 table-body-size">
                                    <textarea class="form-control border-0 table-body-size" id="decorationDescription_2" rows="3"></textarea>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="product-comment-responsible col border border-secondary-subtle mb-2 bg-light bg-opacity-5 text-dark">
                    <label for="generalResponsibilityComments" class="fs-6 fw-bold table-header-size">Общие комментарии ответственного</label>
                    <textarea class="form-control rounded-0 px-0" id="generalResponsibilityComments" rows="3"></textarea>
                </div>
            </div>
        </div>
        <div class="row mb-3">
            <div>
                <div class="border photos-parent">
                    <div class="border child child1">
                        <div class="child-container">
<!--                            <input type="file" class="image-input" accept="image/*">-->
                            <img id="previewImageFabric" class="previewImage" src="https://autogear.ru/misc/i/gallery/44995/1459944.jpg" alt="Preview">
                        </div>
                    </div>
                    <div class="border child child2">
                        <input type="file" class="image-input" accept="image/*">
                        <img id="previewImage1" class="previewImage" src="" alt="Preview">
                    </div>
                    <div class="border child child3">
                        <input type="file" class="image-input" accept="image/*">
                        <img id="previewImage2" class="previewImage" src="" alt="Preview">
                    </div>
                    <div class="border child child4">
                        <input type="file" class="image-input" accept="image/*">
                        <img id="previewImage3" class="previewImage" src="" alt="Preview">
                    </div>
                    <div class="border child child5">
                        <input type="file" class="image-input" accept="image/*">
                        <img id="previewImage4" class="previewImage" src="" alt="Preview">
                    </div>
                </div>
            </div>

<!--            <div class="border border-secondary-subtle p-0 product-photos-container">-->
<!--                <div class="product-fabric ">-->
<!--                    <div class="card border-secondary-subtle mh-100 w-100 file-upload-container">-->
<!--                        <input type="file" id="fabricInput" accept="image/2*" class="file-upload-input" style="display: none;">-->
<!--                        <label for="fabricInput" class="file-upload-label">-->
<!--                            <div class="upload-icon">&#x1F4E5;</div>-->
<!--                            <div class="upload-text">Загрузить файл ткани</div>-->
<!--                            <img id="" src="#" alt="Preview" class="preview-image" style="display: none;">-->
<!--                        </label>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="product-photo-row-1 d-flex flex-row justify-content-center">-->
<!--                    <div class="product-photo-1 mw-50  align-self-center">-->
<!--                        <div class="card border-secondary-subtle mh-100 w-100 file-upload-container">-->
<!--                            <input type="file" id="photo_1" accept="image/3*" class="file-upload-input" style="display: none;">-->
<!--                            <label for="photo_1" class="file-upload-label">-->
<!--                                <div class="upload-icon">&#x1F4E5;</div>-->
<!--                                <div class="upload-text">Загрузить файл вида спереди</div>-->
<!--                                <img id="imgPhoto_1" src="#" alt="Preview" class="preview-image" style="display: none;">-->
<!--                            </label>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="product-photo-row-2">-->
<!--                    <div class="product-photo-2">-->
<!--                        <div class="card border-secondary-subtle mh-100 w-100 file-upload-container">-->
<!--                            <input type="file" id="photo_2" accept="image/3*" class="file-upload-input" style="display: none;">-->
<!--                            <label for="photo_2" class="file-upload-label">-->
<!--                                <div class="upload-icon">&#x1F4E5;</div>-->
<!--                                <div class="upload-text">Загрузить файл вида сверху</div>-->
<!--                                <img id="imgPhoto_2" src="#" alt="Preview" class="preview-image" style="display: none;">-->
<!--                            </label>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="product-photo-3">-->
<!--                        <div class="card border-secondary-subtle mh-100 w-100 file-upload-container">-->
<!--                            <input type="file" id="photo_3" accept="image/3*" class="file-upload-input" style="display: none;">-->
<!--                            <label for="photo_3" class="file-upload-label">-->
<!--                                <div class="upload-icon">&#x1F4E5;</div>-->
<!--                                <div class="upload-text">Загрузить файл вида слева</div>-->
<!--                                <img id="imgPhoto_3" src="#" alt="Preview" class="preview-image" style="display: none;">-->
<!--                            </label>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script type="module" src="{% static 'scripts/libs/chosen_v1.8.7/docsupport/jquery-3.2.1.min.js' %}"></script>
    <script type="module" src="{% static 'scripts/libs/chosen_v1.8.7/chosen.jquery.min.js' %}"></script>
    <script type="module" src="{% static 'scripts/msp.js' %}"></script>

    <script>
        document.addEventListener('change', function(event) {
            if (event.target.classList.contains('file-upload-input')) {
                const parent = event.target.parentNode;
                const fileInput = event.target;
                const file = fileInput.files[0];

                if (file) {
                    const uploadIcon = parent.querySelector('.upload-icon');
                    const uploadText = parent.querySelector('.upload-text');
                    const previewImage = parent.querySelector('.preview-image');

                    uploadIcon.style.display = 'none';
                    uploadText.style.display = 'none';
                    previewImage.style.display = 'block';
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewImage.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        document.querySelector('.file-upload-label').addEventListener('mouseover', function() {
            this.style.backgroundColor = '#f0f0f0';
        });

        document.querySelector('.file-upload-label').addEventListener('mouseout', function() {
            this.style.backgroundColor = 'transparent';
        });
    </script>

    <script>
        function updateParentHeight() {
            const parent = document.querySelector('.photos-parent');
            const parentWidth = parent.clientWidth;
            const coefficient = Math.SQRT2;
            console.log(parentWidth, parentWidth / coefficient);
            parent.style.height = (parentWidth / coefficient) + 'px';
        }

        window.addEventListener('resize', function() {
            updateParentHeight();
        });

        document.addEventListener('DOMContentLoaded', function() {
            updateParentHeight();
        });
    </script>

</body>
</html>
